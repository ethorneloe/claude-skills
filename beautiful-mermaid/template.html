<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagram Title</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            background: #fafafa;
            -webkit-font-smoothing: antialiased;
        }
        
        body.maximized {
            overflow: hidden;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0 0 24px 0;
            text-align: center;
        }
        
        .controls-wrapper {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 24px;
            transition: opacity 0.3s ease;
        }
        
        .controls-wrapper.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .controls-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .controls-label {
            font-size: 13px;
            font-weight: 500;
            color: #525252;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .theme-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .theme-btn {
            padding: 10px 18px;
            border: 1px solid #d4d4d4;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            color: #404040;
        }
        
        .theme-btn:hover {
            background: #f5f5f5;
            border-color: #a3a3a3;
        }
        
        .theme-btn.active {
            background: #1a1a1a;
            color: white;
            border-color: #1a1a1a;
        }
        
        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            background: white;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid #e5e5e5;
            flex-wrap: wrap;
        }
        
        .zoom-label {
            font-size: 14px;
            font-weight: 500;
            color: #404040;
            min-width: 60px;
        }
        
        .zoom-slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #e5e5e5;
            outline: none;
            min-width: 200px;
        }
        
        .zoom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #1a1a1a;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .zoom-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #1a1a1a;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .zoom-value {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
            min-width: 50px;
            text-align: right;
        }
        
        .reset-btn, .maximize-btn, .download-btn {
            padding: 8px 16px;
            border: 1px solid #d4d4d4;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
            color: #404040;
        }

        .reset-btn:hover, .maximize-btn:hover, .download-btn:hover {
            background: #f5f5f5;
            border-color: #a3a3a3;
        }

        .maximize-btn, .download-btn {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .top-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        
        .diagram-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            border: 1px solid #e5e5e5;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
            overflow: auto;
            cursor: grab;
            width: 100%;
            max-width: 1200px;
            flex: 1;
            min-height: 0;
            transition: all 0.3s ease;
        }
        
        .diagram-container.maximized {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            max-height: 100vh;
            border-radius: 0;
            border: none;
            box-shadow: none;
            z-index: 9999;
            margin: 0;
            padding: 60px 40px 40px 40px;
        }
        
        .diagram-container:active {
            cursor: grabbing;
        }
        
        .diagram-container svg {
            transition: transform 0.2s ease;
            transform-origin: top left;
            display: block;
        }
        
        .close-maximize {
            display: none;
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 10000;
            padding: 10px 20px;
            background: #1a1a1a;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .close-maximize.visible {
            display: block;
        }
        
        .close-maximize:hover {
            background: #2a2a2a;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }
            
            h1 {
                font-size: 20px;
                margin-bottom: 16px;
            }
            
            .diagram-container {
                padding: 20px;
            }
            
            .zoom-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .zoom-slider {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>Diagram Title</h1>
    
    <div class="controls-wrapper" id="controls">
        <div class="top-row">
            <div class="controls-section">
                <div class="controls-label">Theme</div>
                <div class="theme-controls">
                    <button class="theme-btn active" onclick="setTheme('github-light')">Light</button>
                    <button class="theme-btn" onclick="setTheme('github-dark')">Dark</button>
                </div>
            </div>
            <button class="download-btn" onclick="copySVG()">
                <span>&#128203;</span> Copy SVG to Clipboard
            </button>
        </div>

        <div class="controls-section">
            <div class="controls-label">Zoom & View</div>
            <div class="zoom-controls">
                <span class="zoom-label">Zoom:</span>
                <input type="range" class="zoom-slider" id="zoomSlider" min="10" max="300" value="100" step="10">
                <span class="zoom-value" id="zoomValue">100%</span>
                <button class="reset-btn" onclick="resetZoom()">Reset</button>
                <button class="maximize-btn" onclick="toggleMaximize()">
                    <span>⛶</span> Maximize
                </button>
            </div>
        </div>
    </div>
    
    <button class="close-maximize" id="closeBtn" onclick="toggleMaximize()">
        ✕ Close Maximize
    </button>
    
    <div class="diagram-container" id="diagramContainer">
        <!-- INSERT_SVG_HERE -->
        <!-- 
        IMPORTANT: Replace this comment with your rendered SVG content.
        
        The SVG MUST include these CSS custom properties in its style attribute:
        style="--bg:#ffffff;--fg:#1f2328;--line:#6e7781;--accent:#6e7781;background:var(--bg)"
        
        The SVG MUST include these styles inside its <style> tag:
        <style>
          svg {
            --_inner-stroke: #8c959f;  /* Visible borders for small labels */
          }
          text[font-weight="400"] {
            font-weight: 600;  /* Bold text for readability */
          }
        </style>
        -->
    </div>
    
    <script>
        const themes = {
            'github-light': {
                bg: '#ffffff', fg: '#1f2328', line: '#6e7781', accent: '#6e7781',
                pageBg: '#fafafa', pageFg: '#1a1a1a', controlsBg: 'white',
                controlsBorder: '#e5e5e5', controlsText: '#404040', labelColor: '#525252',
                btnBorder: '#d4d4d4', btnHoverBg: '#f5f5f5',
                containerBg: 'white', containerBorder: '#e5e5e5'
            },
            'github-dark': {
                bg: '#0d1117', fg: '#e6edf3', line: '#6e7781', accent: '#6e7781',
                pageBg: '#0d1117', pageFg: '#e6edf3', controlsBg: '#161b22',
                controlsBorder: '#30363d', controlsText: '#c9d1d9', labelColor: '#8b949e',
                btnBorder: '#30363d', btnHoverBg: '#21262d',
                containerBg: '#0d1117', containerBorder: '#30363d'
            }
        };

        let currentTheme = 'github-light';

        function setTheme(themeName) {
            const theme = themes[themeName];
            const svg = document.querySelector('svg');

            if (theme) {
                // Update SVG custom properties
                if (svg) {
                    svg.style.setProperty('--bg', theme.bg);
                    svg.style.setProperty('--fg', theme.fg);
                    svg.style.setProperty('--line', theme.line);
                    svg.style.setProperty('--accent', theme.accent);
                }

                // Update full page styling
                document.body.style.background = theme.pageBg;
                document.querySelector('h1').style.color = theme.pageFg;

                // Update controls
                document.querySelectorAll('.controls-label').forEach(el => {
                    el.style.color = theme.labelColor;
                });
                document.querySelector('.zoom-controls').style.background = theme.controlsBg;
                document.querySelector('.zoom-controls').style.borderColor = theme.controlsBorder;
                document.querySelector('.zoom-label').style.color = theme.controlsText;
                document.querySelector('.zoom-value').style.color = theme.pageFg;

                // Update diagram container
                container.style.background = theme.containerBg;
                container.style.borderColor = theme.containerBorder;

                // Update non-active buttons
                document.querySelectorAll('.theme-btn').forEach(btn => {
                    btn.classList.remove('active');
                    btn.style.background = theme.controlsBg;
                    btn.style.color = theme.controlsText;
                    btn.style.borderColor = theme.btnBorder;
                });
                event.target.classList.add('active');
                event.target.style.background = '#1a1a1a';
                event.target.style.color = 'white';
                event.target.style.borderColor = '#1a1a1a';

                document.querySelectorAll('.reset-btn, .maximize-btn, .download-btn').forEach(btn => {
                    btn.style.background = theme.controlsBg;
                    btn.style.color = theme.controlsText;
                    btn.style.borderColor = theme.btnBorder;
                });

                currentTheme = themeName;
            }
        }
        
        // Zoom functionality
        const slider = document.getElementById('zoomSlider');
        const zoomValue = document.getElementById('zoomValue');
        const container = document.getElementById('diagramContainer');
        const svg = document.querySelector('svg');
        
        let scale = 1;
        let translateX = 0;
        let translateY = 0;
        let isDragging = false;
        let startX, startY;
        
        function updateTransform() {
            if (svg) {
                svg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
            }
        }
        
        function handleZoomSlider(value) {
            scale = value / 100;
            zoomValue.textContent = value + '%';
            updateTransform();
        }
        
        slider.addEventListener('input', (e) => {
            handleZoomSlider(e.target.value);
        });
        
        function resetZoom() {
            scale = 1;
            translateX = 0;
            translateY = 0;
            slider.value = 100;
            zoomValue.textContent = '100%';
            updateTransform();
        }
        
        // Pan and drag functionality
        container.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX - translateX;
            startY = e.clientY - translateY;
            e.preventDefault();
        });
        
        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                updateTransform();
            }
        });
        
        document.addEventListener('mouseup', () => {
            isDragging = false;
        });
        
        // Mouse wheel zoom
        container.addEventListener('wheel', (e) => {
            if (e.ctrlKey) {
                e.preventDefault();
                
                const delta = -Math.sign(e.deltaY);
                let newValue = parseInt(slider.value) + (delta * 10);
                newValue = Math.max(10, Math.min(300, newValue));
                
                slider.value = newValue;
                handleZoomSlider(newValue);
            }
        }, { passive: false });
        
        // Maximize functionality (no browser permissions needed)
        let preMaxScale = 1;
        let preMaxTranslateX = 0;
        let preMaxTranslateY = 0;

        function fitToContainer() {
            if (!svg) return;
            const svgRect = svg.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            const padX = 80, padY = 100;
            const availW = containerRect.width - padX;
            const availH = containerRect.height - padY;
            // Use natural SVG size (at scale=1)
            const natW = svgRect.width / scale;
            const natH = svgRect.height / scale;
            if (natW === 0 || natH === 0) return;
            const fitScale = Math.min(availW / natW, availH / natH, 3);
            scale = fitScale;
            translateX = 0;
            translateY = 0;
            slider.value = Math.round(fitScale * 100);
            zoomValue.textContent = Math.round(fitScale * 100) + '%';
            updateTransform();
        }

        function toggleMaximize() {
            const controls = document.getElementById('controls');
            const closeBtn = document.getElementById('closeBtn');
            const body = document.body;
            const entering = !container.classList.contains('maximized');

            if (entering) {
                preMaxScale = scale;
                preMaxTranslateX = translateX;
                preMaxTranslateY = translateY;
            }

            container.classList.toggle('maximized');
            controls.classList.toggle('hidden');
            closeBtn.classList.toggle('visible');
            body.classList.toggle('maximized');

            if (entering) {
                // Delay to let the CSS transition settle
                requestAnimationFrame(() => fitToContainer());
            } else {
                // Restore previous zoom/pan state
                scale = preMaxScale;
                translateX = preMaxTranslateX;
                translateY = preMaxTranslateY;
                slider.value = Math.round(scale * 100);
                zoomValue.textContent = Math.round(scale * 100) + '%';
                updateTransform();
            }
        }
        
        // ESC key to close maximize
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && container.classList.contains('maximized')) {
                toggleMaximize();
            }
        });

        // Copy SVG source to clipboard
        function copySVG() {
            const svgEl = document.querySelector('svg');
            const btn = document.querySelector('.download-btn');
            if (!svgEl) return;
            const serializer = new XMLSerializer();
            const svgString = serializer.serializeToString(svgEl);
            const ta = document.createElement('textarea');
            ta.value = svgString;
            ta.setAttribute('readonly', '');
            ta.style.cssText = 'position:fixed;left:-9999px';
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
            const original = btn.innerHTML;
            btn.innerHTML = '<span>&#10003;</span> Copied!';
            setTimeout(() => { btn.innerHTML = original; }, 2000);
        }

        // Apply default theme and sanitize SVG on load
        window.addEventListener('DOMContentLoaded', () => {
            const svgEl = document.querySelector('svg');
            if (svgEl) {
                // Remove any escaped line break tags that render as literal text
                svgEl.querySelectorAll('text, tspan').forEach(el => {
                    el.textContent = el.textContent.replace(/<br\s*\/?>/gi, ' ').replace(/&lt;br\s*\/?&gt;/gi, ' ');
                });

                // Apply default theme
                const theme = themes[currentTheme];
                if (theme) {
                    svgEl.style.setProperty('--bg', theme.bg);
                    svgEl.style.setProperty('--fg', theme.fg);
                    svgEl.style.setProperty('--line', theme.line);
                    svgEl.style.setProperty('--accent', theme.accent);
                }
            }
        });
    </script>
</body>
</html>
